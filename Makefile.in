CC = @CC@
CFLAGS = @CFLAGS@ -Wall @DEFS@ -I@srcdir@ -I.

ifdef BUILD_OPT
# Optimized
CFLAGS += -O -UDEBUG -DNDEBUG
else
# Debug
CFLAGS += -g -DDEBUG -UNDEBUG
endif

MDDEPDIR=.deps

srcdir=@srcdir@
VPATH=@srcdir@

.c.o:
	$(CC) -c $(CFLAGS) -Wp,-MD,$(MDDEPDIR)/$*.pp -o $@ $<

all: $(MDDEPDIR) rete-test

MDDEPFILES := $(wildcard $(MDDEPDIR)/*.pp)

$(MDDEPDIR):
	mkdir $@

ifdef MDDEPFILES
include $(MDDEPFILES)
endif

CSRCS = \
	alloc.c \
	agent.c \
	ht.c \
	pref.c \
	rete-test.c \
	rete.c \
	runtime.c \
	symtab.c \
	wmem.o \
	$(NULL)

OBJS = $(CSRCS:.c=.o)

rete-test: $(OBJS)

clean:
	rm -rf .deps rete-test *.o *~

distclean: clean
	rm -f Makefile config.cache config.log config.status defs.h

